<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CDN Bakery">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1a1a2e">

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- iOS –∏–∫–æ–Ω–∫–∏ (Safari –¥–æ–±–∞–≤–∏—Ç –Ω–∞ —ç–∫—Ä–∞–Ω –î–æ–º–æ–π) -->
  <link rel="apple-touch-icon" href="icon-192.png">
  <link rel="apple-touch-startup-image" href="icon-512.png">

  <title>CDN Bakery Chat</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      background: #1a1a2e;
    }

    /* ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ ‚îÄ‚îÄ */
    #splash {
      position: fixed;
      inset: 0;
      background: #1a1a2e;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      transition: opacity 0.4s ease;
    }
    #splash.hidden { opacity: 0; pointer-events: none; }

    #splash .logo {
      font-size: 48px;
      margin-bottom: 16px;
    }
    #splash h1 {
      color: #fff;
      font-family: -apple-system, sans-serif;
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    #splash p {
      color: rgba(255,255,255,0.5);
      font-family: -apple-system, sans-serif;
      font-size: 14px;
      margin-bottom: 32px;
    }
    .spinner {
      width: 36px;
      height: 36px;
      border: 3px solid rgba(255,255,255,0.15);
      border-top-color: #6c63ff;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Iframe ‚îÄ‚îÄ */
    #frame-container {
      position: fixed;
      inset: 0;
      /* –ù–∞ iOS –≤ —Ä–µ–∂–∏–º–µ PWA –Ω–µ—Ç —Å—Ç—Ä–æ–∫–∏ Safari ‚Äî –∑–∞–Ω–∏–º–∞–µ–º –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
      /* env(safe-area-inset-*) ‚Äî –æ—Ç—Å—Ç—É–ø—ã –ø–æ–¥ Dynamic Island / Home Indicator */
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: #1a1a2e;
    }

    /* ‚îÄ‚îÄ –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ iframe –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω X-Frame-Options) ‚îÄ‚îÄ */
    #error-screen {
      display: none;
      position: fixed;
      inset: 0;
      background: #1a1a2e;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 32px;
      z-index: 200;
    }
    #error-screen .icon { font-size: 56px; margin-bottom: 20px; }
    #error-screen h2 {
      color: #fff;
      font-family: -apple-system, sans-serif;
      font-size: 20px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 12px;
    }
    #error-screen p {
      color: rgba(255,255,255,0.55);
      font-family: -apple-system, sans-serif;
      font-size: 14px;
      text-align: center;
      line-height: 1.6;
      margin-bottom: 28px;
    }
    #error-screen a {
      display: inline-block;
      background: #6c63ff;
      color: #fff;
      font-family: -apple-system, sans-serif;
      font-size: 16px;
      font-weight: 600;
      text-decoration: none;
      padding: 14px 32px;
      border-radius: 14px;
    }
  </style>
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="splash">
  <div class="logo">üçû</div>
  <h1>CDN Bakery Chat</h1>
  <p>chat.cdnbakery.com</p>
  <div class="spinner"></div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π iframe -->
<div id="frame-container">
  <iframe
    id="main-frame"
    src="https://chat.cdnbakery.com/"
    allow="microphone; camera; clipboard-read; clipboard-write"
    sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals allow-downloads"
    title="CDN Bakery Chat">
  </iframe>
</div>

<!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ (–µ—Å–ª–∏ X-Frame-Options –±–ª–æ–∫–∏—Ä—É–µ—Ç) -->
<div id="error-screen">
  <div class="icon">üîí</div>
  <h2>–°–∞–π—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏–µ</h2>
  <p>chat.cdnbakery.com –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–æ —Ñ—Ä–µ–π–º–µ. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ ‚Äî —Å–∞–π—Ç –æ—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ Safari —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏–∫–æ–Ω–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –î–æ–º–æ–π.</p>
  <a href="https://chat.cdnbakery.com/" id="open-link">–û—Ç–∫—Ä—ã—Ç—å —Å–∞–π—Ç</a>
</div>

<script>
  const TARGET = 'https://chat.cdnbakery.com/';
  const frame  = document.getElementById('main-frame');
  const splash = document.getElementById('splash');
  const errorScreen = document.getElementById('error-screen');

  // –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º Service Worker –¥–ª—è PWA
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('sw.js').catch(() => {});
  }

  // –°–∫—Ä—ã–≤–∞–µ–º —Å–ø–ª—ç—à –∫–æ–≥–¥–∞ iframe –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
  frame.addEventListener('load', () => {
    setTimeout(() => splash.classList.add('hidden'), 300);
  });

  // –î–µ—Ç–µ–∫—Ç–∏—Ä—É–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É X-Frame-Options:
  // –ï—Å–ª–∏ —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥ iframe –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
  const blockTimer = setTimeout(() => {
    // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ contentDocument
    try {
      const doc = frame.contentDocument || frame.contentWindow.document;
      // –ï—Å–ª–∏ document –ø—É—Å—Ç–æ–π ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ
      if (!doc || !doc.body || doc.body.innerHTML === '') {
        showError();
      }
    } catch (e) {
      // SecurityError ‚Äî cross-origin, –∑–Ω–∞—á–∏—Ç iframe –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
      splash.classList.add('hidden');
    }
  }, 8000);

  frame.addEventListener('load', () => clearTimeout(blockTimer));

  function showError() {
    splash.classList.add('hidden');
    errorScreen.style.display = 'flex';
  }

  // iOS PWA: –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å—Å—ã–ª–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø—ã—Ç–∞—é—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—å—Å—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
  window.addEventListener('message', (e) => {
    if (e.origin !== new URL(TARGET).origin) return;
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç —Å–∞–π—Ç–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  });
</script>
</body>
</html>
