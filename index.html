<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CDN Bakery">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0f0f1a">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  <title>CDN Bakery Chat</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0f0f1a;
      --card: #1a1a2e;
      --accent: #6c63ff;
      --accent2: #ff6584;
      --text: #ffffff;
      --muted: rgba(255,255,255,0.45);
    }

    html, body {
      width: 100%; height: 100%;
      min-height: 100svh;
      background: var(--bg);
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       Ğ¡ĞŸĞ›Ğ­Ğ¨-Ğ­ĞšĞ ĞĞ
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #splash {
      position: fixed; inset: 0;
      background: var(--bg);
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      z-index: 999;
      padding-bottom: env(safe-area-inset-bottom);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }
    #splash.out {
      opacity: 0;
      transform: scale(1.04);
      pointer-events: none;
    }

    /* ĞĞ½Ğ¸Ğ¼Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ğ½ */
    #splash::before {
      content: '';
      position: absolute; inset: 0;
      background:
        radial-gradient(ellipse 60% 50% at 20% 30%, rgba(108,99,255,0.18) 0%, transparent 70%),
        radial-gradient(ellipse 50% 40% at 80% 70%, rgba(255,101,132,0.12) 0%, transparent 70%);
      animation: bgPulse 4s ease-in-out infinite alternate;
    }
    @keyframes bgPulse {
      from { opacity: 0.6; }
      to   { opacity: 1; }
    }

    /* Ğ›Ğ¾Ğ³Ğ¾Ñ‚Ğ¸Ğ¿ */
    .splash-icon-wrap {
      position: relative;
      width: 100px; height: 100px;
      margin-bottom: 28px;
    }
    .splash-icon-bg {
      position: absolute; inset: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border-radius: 28px;
      box-shadow: 0 20px 60px rgba(108,99,255,0.4);
      animation: iconFloat 3s ease-in-out infinite;
    }
    @keyframes iconFloat {
      0%, 100% { transform: translateY(0); }
      50%       { transform: translateY(-8px); }
    }
    .splash-icon-emoji {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 48px;
    }

    /* ĞšĞ¾Ğ»ÑŒÑ†Ğ¾ Ğ²Ğ¾ĞºÑ€ÑƒĞ³ Ğ¸ĞºĞ¾Ğ½ĞºĞ¸ */
    .splash-ring {
      position: absolute;
      inset: -12px;
      border: 2px solid rgba(108,99,255,0.3);
      border-radius: 38px;
      animation: ringPulse 2s ease-out infinite;
    }
    .splash-ring:nth-child(2) { inset: -22px; border-radius: 46px; animation-delay: 0.4s; border-color: rgba(108,99,255,0.15); }
    @keyframes ringPulse {
      0%   { transform: scale(0.9); opacity: 0; }
      50%  { opacity: 1; }
      100% { transform: scale(1.1); opacity: 0; }
    }

    .splash-title {
      color: var(--text);
      font-size: 26px; font-weight: 700;
      letter-spacing: -0.5px;
      position: relative;
      margin-bottom: 6px;
    }
    .splash-sub {
      color: var(--muted);
      font-size: 14px;
      position: relative;
      margin-bottom: 48px;
    }

    /* ĞŸÑ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€ */
    .progress-wrap {
      position: relative;
      width: 160px; height: 3px;
      background: rgba(255,255,255,0.08);
      border-radius: 99px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border-radius: 99px;
      width: 0%;
      animation: progress 2s cubic-bezier(0.4,0,0.2,1) forwards;
    }
    @keyframes progress {
      0%   { width: 0%; }
      60%  { width: 75%; }
      90%  { width: 92%; }
      100% { width: 100%; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ĞŸĞ›ĞĞ’ĞĞ®Ğ©ĞĞ¯ ĞŸĞĞĞ•Ğ›Ğ¬ Ğ£ĞŸĞ ĞĞ’Ğ›Ğ•ĞĞ˜Ğ¯
       ĞŸĞ¾ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿Ğ¾Ğ²ĞµÑ€Ñ… ÑĞ°Ğ¹Ñ‚Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚Ğ°
       (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½Ğ¾ ĞºĞ°Ğº PWA)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #ctrl-panel {
      display: none; /* Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² standalone-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğµ Ñ‡ĞµÑ€ĞµĞ· JS */
      position: fixed;
      bottom: calc(20px + env(safe-area-inset-bottom));
      left: 50%; transform: translateX(-50%);
      z-index: 9999;
      background: rgba(15,15,26,0.85);
      backdrop-filter: blur(20px) saturate(1.8);
      -webkit-backdrop-filter: blur(20px) saturate(1.8);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 22px;
      padding: 10px 16px;
      display: none;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
      /* Drag */
      cursor: grab;
      user-select: none;
      touch-action: none;
      transition: opacity 0.3s;
    }
    #ctrl-panel.visible { display: flex; }
    #ctrl-panel.faded { opacity: 0.25; }

    .ctrl-btn {
      width: 40px; height: 40px;
      border: none; outline: none;
      background: rgba(255,255,255,0.07);
      color: var(--text);
      border-radius: 12px;
      font-size: 18px;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      -webkit-tap-highlight-color: transparent;
      transition: background 0.15s, transform 0.1s;
      flex-shrink: 0;
    }
    .ctrl-btn:active { background: rgba(255,255,255,0.18); transform: scale(0.92); }
    .ctrl-btn.accent { background: rgba(108,99,255,0.3); }

    .ctrl-divider {
      width: 1px; height: 24px;
      background: rgba(255,255,255,0.1);
      flex-shrink: 0;
    }

    .zoom-label {
      color: rgba(255,255,255,0.6);
      font-size: 12px; font-weight: 600;
      min-width: 38px; text-align: center;
      font-variant-numeric: tabular-nums;
    }

    /* ĞšĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑ€Ñ‹Ñ‚ÑŒ/Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ */
    #toggle-btn {
      position: fixed;
      bottom: calc(78px + env(safe-area-inset-bottom));
      right: 16px;
      width: 36px; height: 36px;
      border-radius: 50%;
      border: none; outline: none;
      background: rgba(15,15,26,0.7);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      color: rgba(255,255,255,0.5);
      font-size: 16px;
      cursor: pointer;
      display: none;
      align-items: center; justify-content: center;
      z-index: 9998;
      -webkit-tap-highlight-color: transparent;
      transition: opacity 0.2s;
    }
    #toggle-btn.visible { display: flex; }
  </style>
</head>
<body>

<!-- â”€â”€ Ğ¡Ğ¿Ğ»ÑÑˆ-ÑĞºÑ€Ğ°Ğ½ â”€â”€ -->
<div id="splash">
  <div class="splash-icon-wrap">
    <div class="splash-ring"></div>
    <div class="splash-ring"></div>
    <div class="splash-icon-bg"></div>
    <div class="splash-icon-emoji">ğŸ</div>
  </div>
  <div class="splash-title">CDN Bakery Chat</div>
  <div class="splash-sub">chat.cdnbakery.com</div>
  <div class="progress-wrap">
    <div class="progress-bar"></div>
  </div>
</div>

<!-- â”€â”€ ĞŸĞ»Ğ°Ğ²Ğ°ÑÑ‰Ğ°Ñ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ â”€â”€ -->
<!-- Ğ’Ğ¸Ğ´Ğ½Ğ° Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ ÑƒĞ¶Ğµ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ (standalone PWA),
     Ğ¿Ğ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¾Ğ¼ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹ Ñ‡ĞµÑ€ĞµĞ· CSS zoom -->
<div id="ctrl-panel">
  <!-- ĞœĞ°ÑÑˆÑ‚Ğ°Ğ± -->
  <button class="ctrl-btn" id="btn-zoom-out" title="Ğ£Ğ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ÑŒ">âˆ’</button>
  <span class="zoom-label" id="zoom-label">100%</span>
  <button class="ctrl-btn" id="btn-zoom-in" title="Ğ£Ğ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ÑŒ">+</button>
  <button class="ctrl-btn" id="btn-zoom-reset" title="Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±">âŠ™</button>

  <div class="ctrl-divider"></div>

  <!-- Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ/Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ fixed-ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñ‹ ÑĞ°Ğ¹Ñ‚Ğ° -->
  <button class="ctrl-btn" id="btn-toggle-fixed" title="Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ/Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ ÑˆĞ°Ğ¿ĞºÑƒ">â˜°</button>

  <div class="ctrl-divider"></div>

  <!-- ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ -->
  <button class="ctrl-btn" id="btn-reload" title="ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ">â†º</button>
</div>

<!-- ĞœĞ°Ğ»ĞµĞ½ÑŒĞºĞ°Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ° ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ -->
<button id="toggle-btn" title="ĞŸĞ°Ğ½ĞµĞ»ÑŒ">âš™</button>

<script>
  const TARGET = 'https://chat.cdnbakery.com/w/1/c/2429?search=&open=true';

  // Service Worker
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/chatpage/sw.js', { scope: '/chatpage/' }).catch(() => {});
  }

  // â”€â”€ Ğ ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ Ğ¿Ğ¾ÑĞ»Ğµ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€Ğ° â”€â”€
  const splash = document.getElementById('splash');
  const isPWA  = window.navigator.standalone === true
              || window.matchMedia('(display-mode: standalone)').matches;

  setTimeout(() => {
    splash.classList.add('out');
    setTimeout(() => {
      window.location.replace(TARGET);
    }, 400);
  }, 2200);

  // â”€â”€ ĞŸĞ°Ğ½ĞµĞ»ÑŒ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ â”€â”€
  // ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ĞµÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞºĞ¾Ğ³Ğ´Ğ° Ğ¼Ñ‹ ÑƒĞ¶Ğµ Ğ½Ğ° ÑĞ°Ğ¹Ñ‚Ğµ (Ñ‚.Ğµ. ÑÑ‚Ğ¾Ñ‚ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ Ğ·Ğ°Ğ¿ÑƒÑ‰ĞµĞ½
  // ĞĞ• Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚, Ğ° Ğ½Ğ°Ğ¿Ñ€ÑĞ¼ÑƒÑ â€” Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ¼ Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚Ğ¸Ğ¸ PWA
  // ĞºĞ¾Ñ‚Ğ¾Ñ€Ğ°Ñ Ğ·Ğ°ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ»Ğ° ÑÑ‚Ğ°Ñ€ÑƒÑ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñƒ).
  // ĞĞ° Ğ¿Ñ€Ğ°ĞºÑ‚Ğ¸ĞºĞµ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ğ½ÑƒĞ¶Ğ½Ğ° ĞºĞ°Ğº userscript-Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚ â€” ÑĞ¼. userscript.js.

  const panel     = document.getElementById('ctrl-panel');
  const toggleBtn = document.getElementById('toggle-btn');

  if (isPWA) {
    // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ĞµÑĞ»Ğ¸ Ğ¼Ñ‹ ĞĞ• Ğ´ĞµĞ»Ğ°ĞµĞ¼ Ñ€ĞµĞ´Ğ¸Ñ€ĞµĞºÑ‚ (ÑƒĞ¶Ğµ Ğ½Ğ° Ñ†ĞµĞ»ĞµĞ²Ğ¾Ğ¼ ÑĞ°Ğ¹Ñ‚Ğµ)
    // Ğ’ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ ÑÑ‚Ğ¾ Ğ½Ğµ Ğ°ĞºÑ‚ÑƒĞ°Ğ»ÑŒĞ½Ğ¾ â€” Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ´Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾ iframe-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
    // panel.classList.add('visible');
    // toggleBtn.classList.add('visible');
  }

  // ĞœĞ°ÑÑˆÑ‚Ğ°Ğ± (Ğ´Ğ»Ñ iframe-Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° / Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ)
  let zoom = 100;
  const zoomLabel = document.getElementById('zoom-label');

  function setZoom(val) {
    zoom = Math.min(200, Math.max(50, val));
    zoomLabel.textContent = zoom + '%';
    document.body.style.zoom = (zoom / 100);
    // Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² localStorage
    try { localStorage.setItem('pwa_zoom', zoom); } catch(e) {}
  }

  // Ğ’Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ñ‘Ğ½Ğ½Ñ‹Ğ¹ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±
  try {
    const saved = parseInt(localStorage.getItem('pwa_zoom'));
    if (saved && saved !== 100) setZoom(saved);
  } catch(e) {}

  document.getElementById('btn-zoom-out').addEventListener('click', () => setZoom(zoom - 10));
  document.getElementById('btn-zoom-in').addEventListener('click',  () => setZoom(zoom + 10));
  document.getElementById('btn-zoom-reset').addEventListener('click', () => setZoom(100));
  document.getElementById('btn-reload').addEventListener('click', () => location.reload());

  // Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ/Ğ¿Ğ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ
  let panelVisible = true;
  toggleBtn.addEventListener('click', () => {
    panelVisible = !panelVisible;
    panel.classList.toggle('faded', !panelVisible);
    toggleBtn.textContent = panelVisible ? 'âš™' : 'ğŸ‘';
  });

  // ĞŸĞµÑ€ĞµÑ‚Ğ°ÑĞºĞ¸Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸ (drag)
  let dragActive = false, startX, startY, panelX = 0, panelY = 0;

  panel.addEventListener('touchstart', e => {
    if (e.target.closest('.ctrl-btn')) return;
    dragActive = true;
    const t = e.touches[0];
    startX = t.clientX - panelX;
    startY = t.clientY - panelY;
    panel.style.transition = 'none';
  }, { passive: true });

  panel.addEventListener('touchmove', e => {
    if (!dragActive) return;
    const t = e.touches[0];
    panelX = t.clientX - startX;
    panelY = t.clientY - startY;
    panel.style.transform = `translateX(calc(-50% + ${panelX}px)) translateY(${panelY}px)`;
  }, { passive: true });

  panel.addEventListener('touchend', () => { dragActive = false; });
</script>
</body>
</html>
